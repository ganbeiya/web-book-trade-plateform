<%# The html code with Bootstrap 5 design a Inbox page for users; The page is divided into 2 parts: received messages and sent messages %>
<%# Main Content: Two sections as senders and receivers; Each message item with Sender/Receiver email, Book title and content; Each messages have Delete button and reply status%>
<div class="container my-5">
  <h2 class="mb-4">📥 Received Messages</h2>

  <% if @inbox.any? %>
    <% @inbox.each do |message| %>
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <strong>From:</strong> <%= message.sender.email %><br>
              <strong>Book:</strong> <%= link_to message.book.title, book_path(message.book), class: "link-primary" %>
            </div>
            <small class="text-muted"><%= message.created_at.strftime("%Y-%m-%d %H:%M") %></small>
          </div>

          <p class="mt-3 mb-3"><%= message.content %></p>

          <div class="d-flex justify-content-end gap-2">
            <%= link_to "Reply", new_message_path(receiver_id: message.sender.id, book_id: message.book.id, reply_to_id: message.id), class: "btn btn-sm btn-outline-primary" %>
            <%= button_to "Delete", message_path(message), method: :delete, data: { confirm: "Delete this message?" }, class: "btn btn-sm btn-outline-danger" %>
            <% if message.replied_by_receiver? %>
              <span class="badge bg-success align-self-center">✔️ Replied</span>
            <% else %>
              <span class="badge bg-secondary align-self-center">⏰ Not replied</span>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="alert alert-info">You have no received messages.</div>
  <% end %>

  <hr class="my-5">

  <h2 class="mb-4">📤 Sent Messages</h2>

  <% if @sent.any? %>
    <% @sent.each do |message| %>
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <strong>To:</strong> <%= message.receiver.email %><br>
              <strong>Book:</strong> <%= link_to message.book.title, book_path(message.book), class: "link-primary" %>
            </div>
            <small class="text-muted"><%= message.created_at.strftime("%Y-%m-%d %H:%M") %></small>
          </div>

          <p class="mt-3 mb-3"><%= message.content %></p>

          <div class="d-flex justify-content-end gap-2">
            <%= button_to "Delete", message_path(message), method: :delete, data: { confirm: "Delete this message?" }, class: "btn btn-sm btn-outline-danger" %>
            <% if message.replied_by_receiver? %>
              <span class="badge bg-success align-self-center">✔️ Replied by receiver</span>
            <% else %>
              <span class="badge bg-secondary align-self-center">⏰ Awaiting reply</span>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="alert alert-info">You haven’t sent any messages yet.</div>
  <% end %>
</div>
